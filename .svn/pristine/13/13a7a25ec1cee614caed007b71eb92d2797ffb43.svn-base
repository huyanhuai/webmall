<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>我的联系人</title>
    <link rel="stylesheet" href="static/css/base.css">
    <link rel="stylesheet" href="static/css/public.css">
    <link rel="stylesheet" href="static/css/reservation.css">
    <link rel="stylesheet" href="plug-in/meScroll/mescroll.min.css">
    <style>
        /*选择联系人的页面样式*/
        .contact-box {
            width: 100%;
            height: auto;
            overflow: hidden;
            background: #fff;
            margin-top: 0.24rem;
        }

        .contact-item {
            height: 1.6rem;
            margin: 0 0.15rem;
            padding: 0.1rem 0.3rem;
            border-bottom: 0.01rem solid #e5e5e5;
        }

        .contact-box .contact-item:last-child {
            border-bottom: none;
        }

        .contact-left {
            width: 70%;
            float: left;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            display: -webkit-flex;
            -webkit-flex-direction: column;
            -webkit-justify-content: space-around;
        }

        .contact-left p:nth-child(1) {
            font-size: 0.3rem;
            color: #494949;
        }

        .contact-left p:nth-child(2) {
            font-size: 0.24rem;
            color: #494949;
        }

        .contact-left p:nth-child(3) {
            font-size: 0.24rem;
            color: #494949;
        }

        .contact-right {
            width: 30%;
            float: left;
            height: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;
            display: -webkit-flex;
            -webkit-align-items: center;
            -webkit-justify-content: space-around;
        }

        .contact-right span {
            width: 0.7rem;
            height: 0.4rem;
            background: #ffffff;
            border-radius: 0.05rem;
            border: solid 0.01rem #eb001d;
            font-size: 0.24rem;
            color: #eb001d;
            display: flex;
            align-items: center;
            justify-content: center;
            display: -webkit-flex;
            -webkit-align-items: center;
            -webkit-justify-content: center;
        }

        .tab-pal.active {
            display: none;
        }

        /*选择联系人的页面样式*/
        /*编辑联系人页面样式*/
        .edit-required, .edit-choose {
            width: 100%;
            height: 3.28rem;
        }

        .edit-message {
            width: 100%;
            height: 0.88rem;
            padding: 0 0.45rem;
            font-size: 0.3rem;
            color: #494949;
            line-height: 0.9rem;
        }

        .edit-item {
            width: 100%;
            height: 0.8rem;
            background: #fff;
            padding: 0 0.45rem;
            border-bottom: 0.01rem solid #e5e5e5;
            font-size: 0.26rem;
        }

        .edit-required .edit-item:last-child, .edit-choose .edit-item:last-child {
            border-bottom: none;
        }

        .edit-item label {
            width: 25%;
            height: 100%;
            float: left;
            line-height: 0.85rem;
            color: #6a6a6a;
        }

        .edit-item input, .edit-item select {
            width: 75%;
            height: 99%;
            float: left;
            line-height: 0.85rem;
            font-size: 0.28rem;
        }

        .edit-item select {
            outline: none;
            border: none;
            appearance: none;
            -moz-appearance: none;
            -webkit-appearance: none;
            background: #fff;
            color: #6a6a6a;
        }

        select::-ms-expand {
            display: none;
        }

        footer {
            width: 100%;
            height: 0.82rem;
            position: fixed;
            bottom: 0;
            background: #fff;
        }

        /*编辑联系人页面样式*/
        #mescroll{
            height: auto!important;
            position: fixed;
            top: 0.9rem;
            bottom: 0.82rem;
        }
    </style>
</head>
<body>
<!--我的联系人-->
<section id="contact" class="tab-pal">
    <header>
        <div class="navigation forbidScrollIos">
            <img src="static/img/public/return2@2x.png" alt="" onclick="returnBack()">
            我的联系人
        </div>
    </header>
    <main class="mescroll" id="mescroll">
        <div class="contact-box content" id="myContactAll">

        </div>
    </main>
    <footer>
        <div class="submit-btn" onclick="jumpAdd()">
            + 添加常用联系人
        </div>
    </footer>
</section>
<!--修改联系人-->
<section id="editContact" class="tab-pal active">
    <header>
        <div class="navigation forbidScrollIos">
            <img src="static/img/public/return2@2x.png" alt="" onclick="returnChoose()">
            修改联系人
        </div>
    </header>
    <main style="margin-bottom: 0.82rem;">
        <div class="edit-required">
            <div class="edit-message">
                必填信息
            </div>
            <div class="edit-item">
                <label for="editPeopleName">游客</label>
                <input type="text" id="editPeopleName" placeholder="请填写真实姓名">
            </div>
            <div class="edit-item">
                <label for="editPeoplePhone">手机号</label>
                <input type="text" id="editPeoplePhone" placeholder="用于接收确认短信">
            </div>
            <div class="edit-item">
                <label for="editPeopleNumber">身份证</label>
                <input type="text" id="editPeopleNumber" placeholder="请填写证件号码">
            </div>
        </div>
        <div class="edit-choose">
            <div class="edit-message">
                选填信息
            </div>
            <div class="edit-item">
                <label for="editPeopleEmail">电子邮箱</label>
                <input type="text" id="editPeopleEmail" placeholder="请填写联系人邮箱">
            </div>
            <div class="edit-item">
                <label for="editPeopleAddress">联系地址</label>
                <input type="text" id="editPeopleAddress" placeholder="请填写联系人地址">
            </div>
            <div class="edit-item">
                <label for="editPeopleSex">性别</label>
                <select name="" id="editPeopleSex">
                    <option value="0">未知</option>
                    <option value="1">男</option>
                    <option value="2">女</option>
                </select>
            </div>
        </div>
    </main>
    <footer>
        <div class="submit-btn" id="submitEdit">
            确认保存
        </div>
    </footer>
</section>
<!--添加联系人-->
<section id="addContact" class="tab-pal active">
    <header>
        <div class="navigation forbidScrollIos">
            <img src="static/img/public/return2@2x.png" alt="" onclick="returnChoose()">
            添加联系人
        </div>
    </header>
    <main style="margin-bottom: 0.82rem;">
        <div class="edit-required">
            <div class="edit-message">
                必填信息
            </div>
            <div class="edit-item">
                <label for="addPeopleName">游客</label>
                <input type="text" id="addPeopleName" placeholder="请填写真实姓名">
            </div>
            <div class="edit-item">
                <label for="addPeoplePhone">手机号</label>
                <input type="number" id="addPeoplePhone" maxlength="11" placeholder="用于接收确认短信">
            </div>
            <div class="edit-item">
                <label for="addPeopleNumber">身份证</label>
                <input type="text" id="addPeopleNumber" maxlength="18" placeholder="请填写证件号码">
            </div>
        </div>
        <div class="edit-choose">
            <div class="edit-message">
                选填信息
            </div>
            <div class="edit-item">
                <label for="addPeopleEmail">电子邮箱</label>
                <input type="email" id="addPeopleEmail" placeholder="请填写联系人邮箱">
            </div>
            <div class="edit-item">
                <label for="addPeopleAddress">联系地址</label>
                <input type="text" id="addPeopleAddress" placeholder="请填写联系人地址">
            </div>
            <div class="edit-item">
                <label for="addPeopleSex">性别</label>
                <!--<input type="text" id="addPeopleSex" placeholder="请填写您的性别">-->
                <select name="" id="addPeopleSex">
                    <option value="0">未知</option>
                    <option value="1">男</option>
                    <option value="2">女</option>
                </select>
            </div>
        </div>
    </main>
    <footer>
        <div class="submit-btn" id="submitAdd">
            确认保存
        </div>
    </footer>
</section>
</body>
</html>
<script src="static/js/jquery-3.2.1.min.js"></script>
<script src="static/js/localStorage.js"></script>
<script src="static/js/ajaxTool.js"></script>
<script src="static/js/public.js"></script>
<script src="plug-in/layer_mobile/layer.js"></script>
<script src="plug-in/meScroll/mescroll.min.js"></script>
<script src="static/js/upLoading.js"></script>
<script type="text/javascript" src="static/js/history.js"></script>
<script>
    $(function () {
        //获取联系人
        init();
    });
    function init(){
        var url = baseAjaxUrl + "/ty_api/customer/getListByUserId";
        var data = {"type": "SCENE"};
        upLoading(url, data, getUserCall, false);
    }


    /*提交按钮集合*/
    //添加联系人
    $("#submitAdd").click(function () {
        var realname = $("#addPeopleName").val();
        var mobile = $("#addPeoplePhone").val();
        var identityCard = $("#addPeopleNumber").val();
        var mail = $("#addPeopleEmail").val();
        var address = $("#addPeopleAddress").val();
        var sex = $("#addPeopleSex option:selected").val();
        //验证必填字段
        if (realname == '' || mobile == '' || identityCard == '') {
            layMessage("请填写必填字段");
            return false;
        }
        //验证身份证
        if (IDcardReg(identityCard) == false) {
            layMessage("身份证件号格式不正确");
            return false;
        }
        //验证手机号
        if (mobileReg(mobile) == false) {
            layMessage("手机号码格式不正确");
            return false;
        }
        //验证邮箱
        if (mail != '') {
            if (emailReg(mail) == false) {
                layMessage("邮箱格式不正确");
                return false;
            }
        }

        //添加联系人
        publicAjaxToken(baseAjaxUrl + "/ty_api/customer/insertCustomer", "POST", {
            "realname": realname,
            "identityCard": identityCard,
            "mobile": mobile,
            "mail": mail,
            "address": address,
            "sex": sex,
            "type": "SCENE"
        }, addUserCall);
    });
    //编辑联系人
    $("#submitEdit").click(function () {
        var customerId = $(this).attr("data-customerId");
        var realname = $("#editPeopleName").val();
        var mobile = $("#editPeoplePhone").val();
        var identityCard = $("#editPeopleNumber").val();
        var mail = $("#editPeopleEmail").val();
        var address = $("#editPeopleAddress").val();
        var sex = $("#editPeopleSex option:selected").val();
        //验证必填字段
        if (realname == '' || mobile == '' || identityCard == '') {
            layMessage("请填写必填字段");
            return false;
        }
        //验证身份证
        if (IDcardReg(identityCard) == false) {
            layMessage("身份证件号格式不正确");
            return false;
        }
        //验证手机号
        if (mobileReg(mobile) == false) {
            layMessage("手机号码格式不正确");
            return false;
        }
        //验证邮箱
        if (mail != '') {
            if (emailReg(mail) == false) {
                layMessage("邮箱格式不正确");
                return false;
            }
        }

        //添加联系人
        publicAjaxToken(baseAjaxUrl + "/ty_api/customer/insertCustomer", "POST", {
            "customerId": customerId,
            "realname": realname,
            "identityCard": identityCard,
            "mobile": mobile,
            "mail": mail,
            "address": address,
            "sex": sex,
            "type": "SCENE"
        }, addUserCall);
    });

    //删除联系人
    function deletePeople(e) {
        var customerId = $(e).siblings(".customerId").val();
        publicAjaxToken(baseAjaxUrl + "/ty_api/customer/deleteCustomer", "POST", {
            "customerId": customerId
        }, deletePeopleCall)
    }

    /*所有ajax的回调集合*/
    //获取联系人的回调
    function getUserCall(data) {
        // if (res.errorCode == 200) {
        //     console.log(res);
        //     var data=res.data.list;
        var listDom = $("#myContactAll");
        var innerHtml = '';
        for (var i = 0; i < data.length; i++) {
            innerHtml +=
                '<div class="contact-item">\n' +
                '   <div class="contact-left" onclick="choosePeople(this)">\n' +
                '       <p class="contact-name">' + data[i].realname + '</p>\n' +
                '       <p class="contact-phone">' + data[i].mobile + '</p>\n' +
                '       <p class="contact-number">身份证：<span>' + data[i].identityCard + '</span></p>\n' +
                '   </div>\n' +
                '   <div class="contact-right">\n' +
                '       <span onclick="jumpEdit(this)">修改</span>\n' +
                '       <span onclick="deletePeople(this)">删除</span>' +
                '       <input type="hidden" class="customerId" value="' + data[i].customerId + '">' +
                '       <input type="hidden" class="peopleName" value="' + data[i].realname + '">' +
                '       <input type="hidden" class="peopleMobile" value="' + data[i].mobile + '">' +
                '       <input type="hidden" class="peopleIdNum" value="' + data[i].identityCard + '">' +
                '       <input type="hidden" class="peopleEmail" value="' + (data[i].mail == null ? "" : data[i].mail) + '">\n' +
                '       <input type="hidden" class="peopleAdd" value="' + (data[i].address == null ? "" : data[i].address) + '">\n' +
                '       <input type="hidden" class="peopleSex" value="' + data[i].sex + '">' +
                '   </div>\n' +
                '</div>'
        }
        listDom.append(innerHtml);//加在列表的后面,上拉加载
        // }
    }

    //添加联系人的回调
    function addUserCall(res) {
        if (res.errorCode == 200) {
            layMessage("操作成功");
            returnChoose();
            // publicAjaxToken(baseAjaxUrl + "/ty_api/customer/getListByUserId", "POST", {
            //     "pageNum": 1,
            //     "pageSize": 10
            // }, getUserCall);
            clearDown();
            init();
        } else if (res.errorCode == 305) {
            layMessage("该联系人已存在");
            return false;
        }
    }

    //删除联系人的回调
    function deletePeopleCall(res) {
        console.log(res);
        if (res.errorCode == 200) {
            layMessage("删除成功");
            clearDown();
            init();
        }
    }

    /*修改联系人*/
    function jumpEdit(e) {
        $(".tab-pal").hide();
        $("#editContact").show();
        var peopleSex = $(e).siblings(".peopleSex").val();
        console.log($(e).siblings(".peopleName").val());
        var customerId = $(e).siblings(".customerId").val();
        $("#submitEdit").attr("data-customerId", customerId);

        $("#editPeopleName").val($(e).siblings(".peopleName").val());
        $("#editPeoplePhone").val($(e).siblings(".peopleMobile").val());
        $("#editPeopleNumber").val($(e).siblings(".peopleIdNum").val());
        $("#editPeopleEmail").val($(e).siblings(".peopleEmail").val());
        $("#editPeopleAddress").val($(e).siblings(".peopleAdd").val());
        $("#editPeopleSex option").attr("selected", false);
        $("#editPeopleSex option").eq(peopleSex).attr("selected", true);
    }

    /*跳转添加联系人*/
    function jumpAdd() {
        $("#addPeopleName").val("");
        $("#addPeoplePhone").val("");
        $("#addPeopleNumber").val("");
        $("#addPeopleEmail").val("");
        $("#addPeopleAddress").val("");
        $("#addPeopleSex option").attr("selected", false);
        $("#addPeopleSex option").eq(0).attr("selected", true);
        $(".tab-pal").hide();
        $("#addContact").show();
    }

    /*跳转我的联系人*/
    function returnChoose() {
        $(".tab-pal").hide();
        $("#contact").show();
    }


</script>